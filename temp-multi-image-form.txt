function ActionForm({ onSubmit, onCancel, completed = false }) {
  const [formData, setFormData] = useState({
    title: "",
    shortDescription: "",
    fullDescription: "",
    goal: "",
    collected: "",
    mainImage: "",
    gallery: [],
    urgent: false
  })
  const [uploading, setUploading] = useState(false)

  const handleMultiImageUpload = async (e) => {
    const files = Array.from(e.target.files || [])
    if (files.length === 0) return

    setUploading(true)
    const uploadedUrls = []

    for (const file of files) {
      const uploadFormData = new FormData()
      uploadFormData.append("file", file)

      try {
        const res = await fetch("/api/admin/upload", {
          method: "POST",
          body: uploadFormData
        })
        const data = await res.json()
        
        if (data.success) {
          uploadedUrls.push(data.url)
        }
      } catch (error) {
        console.error("Upload error:", error)
      }
    }

    if (uploadedUrls.length > 0) {
      setFormData({
        ...formData, 
        mainImage: uploadedUrls[0],
        gallery: uploadedUrls
      })
    }
    
    setUploading(false)
  }

  const handleSubmit = async (e) => {
    e.preventDefault()
    
    const res = await fetch("/api/admin/actions", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ...formData, completed })
    })

    if (res.ok) {
      onSubmit()
      onCancel()
    } else {
      alert("Greška pri dodavanju akcije")
    }
  }

  return (
    <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
      <h3 className="text-xl font-bold mb-4">
        {completed ? "Nova završena akcija" : "Nova aktivna akcija"}
      </h3>
      <form onSubmit={handleSubmit} className="space-y-4">
        <div>
          <label className="block text-sm font-semibold mb-2">Naslov</label>
          <input
            type="text"
            value={formData.title}
            onChange={(e) => setFormData({...formData, title: e.target.value})}
            className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none"
            required
          />
        </div>

        <div>
          <label className="block text-sm font-semibold mb-2">Kratak opis</label>
          <textarea
            value={formData.shortDescription}
            onChange={(e) => setFormData({...formData, shortDescription: e.target.value})}
            className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none"
            rows="2"
            required
          />
        </div>

        <div>
          <label className="block text-sm font-semibold mb-2">Detaljan opis</label>
          <textarea
            value={formData.fullDescription}
            onChange={(e) => setFormData({...formData, fullDescription: e.target.value})}
            className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none"
            rows="4"
            required
          />
        </div>

        <div className="grid grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-semibold mb-2">Cilj (€)</label>
            <input
              type="number"
              value={formData.goal}
              onChange={(e) => setFormData({...formData, goal: e.target.value})}
              className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none"
              required
            />
          </div>
          <div>
            <label className="block text-sm font-semibold mb-2">Prikupljeno (€)</label>
            <input
              type="number"
              value={formData.collected}
              onChange={(e) => setFormData({...formData, collected: e.target.value})}
              className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none"
              required
            />
          </div>
        </div>

        <div>
          <label className="block text-sm font-semibold mb-2">Slike akcije (možete izabrati više)</label>
          <input
            type="file"
            accept="image/*"
            multiple
            onChange={handleMultiImageUpload}
            className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg"
          />
          {uploading && <p className="text-sm text-primary mt-2">Upload u toku...</p>}
          {formData.gallery.length > 0 && (
            <div className="mt-4 grid grid-cols-3 gap-2">
              {formData.gallery.map((url, idx) => (
                <img key={idx} src={url} alt={`Slika ${idx + 1}`} className="h-24 w-full object-cover rounded-lg" />
              ))}
            </div>
          )}
        </div>

        {!completed && (
          <div className="flex items-center">
            <input
              type="checkbox"
              checked={formData.urgent}
              onChange={(e) => setFormData({...formData, urgent: e.target.checked})}
              className="w-5 h-5"
            />
            <label className="ml-2 text-sm font-semibold">Hitna akcija</label>
          </div>
        )}

        <div className="flex gap-4">
          <button
            type="submit"
            disabled={uploading || !formData.mainImage}
            className="flex-1 bg-primary text-white py-3 rounded-lg font-bold hover:bg-blue-700 disabled:opacity-50"
          >
            Dodaj akciju
          </button>
          <button
            type="button"
            onClick={onCancel}
            className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-400"
          >
            Otkaži
          </button>
        </div>
      </form>
    </div>
  )
}
